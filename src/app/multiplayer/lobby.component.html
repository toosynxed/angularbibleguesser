<div class="lobby-container" *ngIf="lobby$ | async as lobby">
  <div class="lobby-sidebar">
    <div class="lobby-info">
      <h2>Lobby Code</h2>
      <p class="game-code" (click)="copyGameCode(lobby.gameCode)" title="Click to copy">{{ lobby.gameCode }}</p>
      <p class="share-text">{{ copyButtonText }}</p>
    </div>

    <div class="player-list">
      <h2>Players</h2>
      <ul>
        <li *ngFor="let player of players$ | async">
          {{ player.displayName }}
          <span *ngIf="player.isHost" class="host-tag">(Host)</span>
        </li>
      </ul>
    </div>

    <button class="start-game-button" *ngIf="isHost$ | async" (click)="startGame()">Start Game</button>
    <p *ngIf="!(isHost$ | async)">Waiting for host to start the game...</p>

    <!-- Back Button -->
    <button class="back-button secondary" (click)="goBack()">Back to Home</button>
  </div>

  <div class="settings-main">
    <h2>Game Settings</h2>
    <ng-container *ngIf="settings">
      <div class="settings-form">
        <!-- Rounds -->
        <div class="form-group">
          <label for="rounds">Rounds</label>
          <input type="number" id="rounds" [(ngModel)]="settings.rounds" (ngModelChange)="onSettingsChange()" [disabled]="!(isHost$ | async)">
        </div>

        <!-- Time Limit -->
        <div class="form-group">
          <label for="timeLimit">Time Limit per Round</label>
          <select id="timeLimit" [(ngModel)]="settings.timeLimit" (ngModelChange)="onSettingsChange()" [disabled]="!(isHost$ | async)">
            <option *ngFor="let option of timeOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>

        <!-- Context Size -->
        <div class="form-group">
          <label for="contextSize">Context Verses: {{ settings.contextSize }}</label>
          <input type="range" id="contextSize" min="0" max="250" [(ngModel)]="settings.contextSize" (ngModelChange)="onSettingsChange()" [disabled]="!(isHost$ | async)">
        </div>

        <!-- Book Selection -->
        <div class="book-selection">
          <h3>Select Books</h3>
          <div *ngFor="let group of bookGroups" class="book-group">
            <h4 (click)="toggleBookGroup(group)" [class.clickable]="isHost$ | async">
              {{ group.groupName }}
            </h4>
            <div class="book-grid">
              <button
                *ngFor="let book of group.books"
                [class.selected]="settings.books.includes(book)"
                (click)="toggleBook(book)"
                [disabled]="!(isHost$ | async)">
                {{ book }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>
