<div class="container">
  <header>
    <h1>Game Over!</h1>
    <p>Here's how you did.</p>
  </header>

  <main>
    <!-- MULTIPLAYER RESULTS -->
    <div *ngIf="lobby">
      <h2>Final Leaderboard</h2>
      <div class="leaderboard-list">
        <table>
          <thead>
            <tr>
              <th>Rank</th>
              <th>Player</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of leaderboard">
              <td>{{ item.rank }}</td>
              <td>{{ item.player.displayName }} <span *ngIf="item.player.isHost">(Host)</span></td>
              <td>{{ item.totalScore }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <h2 class="your-results-title">Your Results</h2>
      <div class="total-score">
        <h3>Total Score: {{ totalScore }} / {{ lobby.gameSettings.rounds * 100 }}</h3>
      </div>
      <div class="results-list">
        <div *ngFor="let result of playerResults" class="result-card">
          <h3>Round {{ result.round }}</h3>
          <p><strong>Your Guess:</strong> {{ result.guess }}</p>
          <p><strong>Correct Verse:</strong> {{ result.verse.bookName }} {{ result.verse.chapter }}:{{ result.verse.verse }}</p>
          <p class="score"><strong>Score:</strong> {{ result.score }} / 100</p>
        </div>
      </div>
    </div>

    <!-- SINGLE PLAYER RESULTS -->
    <div *ngIf="!lobby && results.length > 0" class="results-list">
      <div class="total-score">
        <h2>Total Score: {{ totalScore }} / {{ results.length * 100 }}</h2>
      </div>
      <div *ngFor="let result of results; let i = index" class="result-card" (click)="toggleExpand(i)">
        <div class="result-summary">
          <h3>Round {{ i + 1 }}</h3>
          <p class="score"><strong>Score:</strong> {{ result.score }} / 100</p>
          <div class="stars">
            <span *ngFor="let _ of getStarArray(result.stars)" class="star filled">★</span>
            <span *ngFor="let _ of getStarArray(3 - result.stars)" class="star">☆</span>
          </div>
          <span class="expand-icon">{{ expandedIndex === i ? '▲' : '▼' }}</span>
        </div>

        <div class="details" *ngIf="expandedIndex === i">
          <p><strong>Correct Verse:</strong> {{ result.verse.bookName }} {{ result.verse.chapter }}:{{ result.verse.verse }}</p>
          <p><strong>Your Guess:</strong>
            <span *ngIf="result.guess">{{ result.guess.book }} {{ result.guess.chapter }}:{{ result.guess.verse }}</span>
            <span *ngIf="!result.guess">Invalid</span>
          </p>
          <p class="verse-text">"{{ result.verse.text }}"</p>
          <div class="indicators">
            <div class="indicator">
              <span class="circle" [class.correct]="result.isBookCorrect" [class.incorrect]="!result.isBookCorrect"></span>
              <span>Book</span>
            </div>
            <div class="indicator">
              <span class="circle" [class.correct]="result.isBookCorrect && result.isChapterCorrect" [class.incorrect]="!(result.isBookCorrect && result.isChapterCorrect)"></span>
              <span>Chapter</span>
            </div>
            <div class="indicator">
              <span class="circle" [class.correct]="result.isBookCorrect && result.isChapterCorrect && result.isVerseCorrect" [class.incorrect]="!(result.isBookCorrect && result.isChapterCorrect && result.isVerseCorrect)"></span>
              <span>Verse</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="share-container">
      <h3>Share this Game</h3>
      <p>Send this code to a friend to let them play the same verses!</p>
      <div class="code-actions">
        <input type="text" [value]="shareCode" readonly>
        <button (click)="copyCode()">{{ copyButtonText }}</button>
      </div>
    </div>

    <div class="actions">
      <a routerLink="/">Play Again</a>
    </div>
  </main>
</div>
